<div class="page-container">
  <div class="row">
    <div class="col-md-12">
      <div class="card">
        <div class="card-body">
          <form [formGroup]="CompanyForm" (submit)="SaveCompanyInfo()" enctype="multipart/form-data" novalidate>
            <div class="section-header mb-3">
              <h6 class="border-bottom pb-2">Basic Information</h6>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Company Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" formControlName="CompanyName"
                  [class.is-invalid]="CompanyForm.controls['CompanyName'].invalid && CompanyForm.controls['CompanyName'].touched"
                  placeholder="Enter company name" required>
                @if(CompanyForm.controls['CompanyName'].invalid && CompanyForm.controls['CompanyName'].touched){
                <div class="invalid-feedback">Company name is required (min 3 characters)</div>
                }
              </div>
              <div class="col-md-6">
                <label class="form-label">Website URL</label>
                <input type="url" class="form-control" formControlName="WebsiteUrl" placeholder="https://example.com">
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Domain URL <span class="text-danger">*</span></label>
                <input type="text" class="form-control" formControlName="DomainUrl"
                  [class.is-invalid]="CompanyForm.controls['DomainUrl'].invalid && CompanyForm.controls['DomainUrl'].touched"
                  placeholder="company.com" required>
                @if(CompanyForm.controls['DomainUrl'].invalid && CompanyForm.controls['DomainUrl'].touched){
                <div class="invalid-feedback">Domain URL is required</div>
                }
              </div>
              <div class="col-md-6">
                <label class="form-label">Contact Email</label>
                <input type="email" class="form-control" formControlName="ContactEmail" placeholder="info@company.com">
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Contact Phone</label>
                <input type="tel" class="form-control" formControlName="ContactPhone" placeholder="+1234567890">
              </div>
            </div>

            <div class="section-header mb-3 mt-4">
              <h6 class="border-bottom pb-2">Legal Information</h6>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Tax Registration Number <span class="text-danger">*</span></label>
                <input type="text" class="form-control" formControlName="TaxRegistrationNumber"
                  [class.is-invalid]="CompanyForm.controls['TaxRegistrationNumber'].invalid && CompanyForm.controls['TaxRegistrationNumber'].touched"
                  placeholder="Enter tax registration number" required>
                @if(CompanyForm.controls['TaxRegistrationNumber'].invalid &&
                CompanyForm.controls['TaxRegistrationNumber'].touched){
                <div class="invalid-feedback">Tax registration number is required</div>
                }
              </div>
              <div class="col-md-6">
                <label class="form-label">Commercial Registration Number <span class="text-danger">*</span></label>
                <input type="text" class="form-control" formControlName="CommercialNumber"
                  [class.is-invalid]="CompanyForm.controls['CommercialNumber'].invalid && CompanyForm.controls['CommercialNumber'].touched"
                  placeholder="Enter commercial number" required>
                @if(CompanyForm.controls['CommercialNumber'].invalid &&
                CompanyForm.controls['CommercialNumber'].touched){
                <div class="invalid-feedback">Commercial number is required</div>
                }
              </div>
            </div>

            <div class="section-header mb-3 mt-4">
              <h6 class="border-bottom pb-2">Location Information</h6>
            </div>

            <div class="row mb-3">
              <div class="col-md-12">
                <label class="form-label">Address <span class="text-danger">*</span></label>
                <textarea class="form-control" rows="3" formControlName="Address"
                  [class.is-invalid]="CompanyForm.controls['Address'].invalid && CompanyForm.controls['Address'].touched"
                  placeholder="Address will be auto-filled from map" readonly required></textarea>
                @if(CompanyForm.controls['Address'].invalid && CompanyForm.controls['Address'].touched){
                <div class="invalid-feedback">Address is required</div>
                }
                <button type="button" class="btn btn-outline-secondary btn-sm mt-2" (click)="openMapModal()"
                  [disabled]="loading">
                  <i class="bi bi-geo-alt-fill me-1"></i> Pick Location on Map
                </button>
                <small class="text-muted d-block mt-1">
                  <i class="bi bi-info-circle me-1"></i>
                  Click the button to open map and select your company location
                </small>
              </div>
            </div>

            <div class="row mb-3" *ngIf="CompanyForm.value.Latitude && CompanyForm.value.Longitude">
              <div class="col-md-4">
                <label class="form-label">Latitude</label>
                <input type="text" class="form-control" formControlName="Latitude" readonly>
              </div>
              <div class="col-md-4">
                <label class="form-label">Longitude</label>
                <input type="text" class="form-control" formControlName="Longitude" readonly>
              </div>
              <div class="col-md-4">
                <label class="form-label">Allowed Radius (meters) <span class="text-danger">*</span></label>
                <input type="number" class="form-control" formControlName="AllowedRadiusMeters"
                  [class.is-invalid]="CompanyForm.controls['AllowedRadiusMeters'].invalid && CompanyForm.controls['AllowedRadiusMeters'].touched"
                  placeholder="100" min="10">
                @if(CompanyForm.controls['AllowedRadiusMeters'].invalid &&
                CompanyForm.controls['AllowedRadiusMeters'].touched){
                <div class="invalid-feedback">Radius must be at least 10 meters</div>
                }
              </div>
            </div>

            <div class="section-header mb-3 mt-4">
              <h6 class="border-bottom pb-2">Company Assets</h6>
            </div>

            <div class="row mb-3">
              <div class="col-md-4">
                <label class="form-label">Company Logo</label>
                <div class="input-group">
                  <input type="file" class="form-control" (change)="onLogoSelected($event)" accept="image/*">
                </div>
                <div *ngIf="CompanyForm.value.CompanyLogo" class="mt-2">
                  <a [href]="CompanyForm.value.CompanyLogo" class="btn btn-sm btn-outline-secondary" target="_blank">
                    <i class="bi bi-download me-1"></i> View Current Logo
                  </a>
                </div>
                <small class="text-muted d-block mt-1">Recommended: PNG/JPG, max 2MB</small>
              </div>

              <div class="col-md-4">
                <label class="form-label">Company Header</label>
                <div class="input-group">
                  <input type="file" class="form-control" (change)="onHeaderSelected($event)" accept="image/*">
                </div>
                <div *ngIf="CompanyForm.value.CompanyHeader" class="mt-2">
                  <a [href]="CompanyForm.value.CompanyHeader" class="btn btn-sm btn-outline-secondary" target="_blank">
                    <i class="bi bi-download me-1"></i> View Current Header
                  </a>
                </div>
                <small class="text-muted d-block mt-1">For reports and documents</small>
              </div>

              <div class="col-md-4">
                <label class="form-label">Company Footer</label>
                <div class="input-group">
                  <input type="file" class="form-control" (change)="onFooterSelected($event)" accept="image/*">
                </div>
                <div *ngIf="CompanyForm.value.CompanyFooter" class="mt-2">
                  <a [href]="CompanyForm.value.CompanyFooter" class="btn btn-sm btn-outline-secondary" target="_blank">
                    <i class="bi bi-download me-1"></i> View Current Footer
                  </a>
                </div>
                <small class="text-muted d-block mt-1">For reports and documents</small>
              </div>
            </div>

            <div class="d-flex justify-content-center gap-3 mt-4 pt-3 border-top">
              <button type="submit" class="btn btn-success rounded-pill px-5"
                [disabled]="loading || CompanyForm.invalid">
                <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
                <i *ngIf="!loading" class="bi bi-check-circle me-1"></i>
                Save Changes
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="staticMap" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
  aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-body p-0">
        <div class="map-container" style="height: 500px; width: 100%;">
          <div id="map" style="height: 100%; width: 100%;"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">
            <i class="bi bi-x-circle me-1"></i> Cancel
          </button>
        </div>
      </div>
    </div>
  </div>